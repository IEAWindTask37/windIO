# Draft schema definition for energy resource
input_format_version: 0
title: Energy resource
type: object
description: >-
  A description of the wind resource available within a site. The wind resource
  can be specified at one location within the site, or at multiple locations.
  At each point specified within the site, the wind resource can be detailed in
  several different ways.
required:
  - name
  - wind_resource
additionalProperties: false


# PROPERTIES
properties:
  #~
  name:
    title: Name
    description: Name of the plant resource
    type: string
  #~
  wind_resource:
    title: Wind resource
    type: object
    decription: Resource where data optionally depend on wind_speed, wind_direction and/or position
    additionalProperties: false    
    oneOf:
        - required: 
          - probability
        - required:
          - weibull_a
          - weibull_k
          - sector_probability
        - required:
          - timeseries
    properties:
        wind_direction:
            title: Wind directions
            description: Wind directions in degrees, [0,360]
            $ref: "#/definitions/multi_dimensional_coordinate"
        wind_speed:
            description: Wind speeds in m/s
            $ref: "#/definitions/multi_dimensional_coordinate"
        wind_turbine:
            title: Wind turbine IDs
            description: Wind turbine id
            $ref: "#/definitions/multi_dimensional_coordinate"
        x:
            title: West-East position
            oneOf:
              - $ref: "#/definitions/multi_dimensional_data"
              - $ref: "#/definitions/multi_dimensional_coordinate"
        y:
            title: South-North position
            oneOf:
              - $ref: "#/definitions/multi_dimensional_data"
              - $ref: "#/definitions/multi_dimensional_coordinate"
        height:
            title: Reference height
            oneOf:
              - $ref: "#/definitions/multi_dimensional_data"
              - $ref: "#/definitions/multi_dimensional_coordinate" 
        probability:
            description: Probability of flow cases [0,1]
            $ref: "#/definitions/multi_dimensional_data"
        weibull_a:
            title: Weibull scale
            $ref: "#/definitions/multi_dimensional_data"
        weibull_k:
            title: Weibull shape
            $ref: "#/definitions/multi_dimensional_data"
        sector_probability:
            title: probability of wind directions
            description: Probability of wind sector [0,1]
            $ref: "#/definitions/multi_dimensional_data"
        turbulence_intensity:
            title: Turbulence intensity
            $ref: "#/definitions/multi_dimensional_data"
        reference_height:
            title: Reference height
            type: number
        shear:
            title: Shear
            $ref: "#/definitions/shear"
        timeseries:
          title: Timeseries
          description: Timeseries for wind conditions
          type: array
          items:
            $ref: "#/definitions/timeseries_entry"
            
             
        


# DEFINITIONS
definitions:
  reference_height:
    title: Reference height
    type: number
  shear:
    title: Shear
    type: object
    required:
      - alpha
      - h_ref
    properties:
      alpha:
        title: Alpha
        type: number
      h_ref:
        title: Shear ref height
        type: number

  
  multi_dimensional_data:
    oneOf:
      - $ref: "#/definitions/dimensional_data"
      - $ref: "#/definitions/nondimensional_data"
      
  dimensional_data:
    title: Data with custom dimensions
    type: object
    properties:
      data:
        type: array
        items:
          type: [array, number]
      dims:
        type: array
        
  nondimensional_data:
    title: Data with custom dimensions
    type: object
    properties:
      data:
        type: number
      dims:
        type: array
        maxItems: 0
        
  multi_dimensional_coordinate:
    oneOf:
      - $ref: "#/definitions/dimensional_coordinate"
      - $ref: "#/definitions/nondimensional_coordinate"
  
  dimensional_coordinate:
    title: Data with custom dimensions
    type: array
    items:
      type: number
    
  nondimensional_coordinate:
    title: Data with custom dimensions
    type: number
  
  timeseries_entry:
    title: Timeseries Entry
    type: object
    required:
      - time
      - direction
      - speed
    properties:
      time:
        type: string
        format: date-time
        description: Timestamp of the data point
      speed:
        description: Wind speed at the given time, either for a specific height or representing vertical variation
        oneOf:
          - type: number
          - type: array
            items:
              type: number
      direction:
        type: number
        oneOf:
          - type: number
          - type: array
            items:
              type: number
        description: Wind direction at the given time
      zs:
        type: array
        description: Vertical positions in meters
        items:
          type: number
      temperature:
        description: Temperature in Kelvin
        type: array
        items:
          type: number
      tauxst:
        description: Shear stress in x direction
        type: array
        items:
          type: number
      tauyst:
        description: Shear stress in y direction
        type: array
        items:
          type: number
      veer:
        description: Wind veer relative to the inflow direction
        type: array
        items:
          type: number

